<!DOCTYPE html>
<html lang="es">
<head>
<meta name="google-site-verification" content="c_cYqLOKurT1wCCCk2jVbM-Gsm4SytBkEgak20nBtjs" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hepatitis B Defender</title>
<style>
:root{
    --bg:#0c1e2a;
    --virus-core:#ff4d4d;
    --virus-spike:#ff9999;
    --panel:#122136;
    --text:#e6f7ff;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{background:linear-gradient(180deg,var(--bg),#020f1a);display:flex;flex-direction:column;align-items:center;padding:12px;}
header{width:100%;max-width:720px;text-align:center;margin-bottom:12px;color:var(--text);}
h1{font-size:24px;margin-bottom:4px;}
.controls{font-size:14px;margin-bottom:12px;color:#b0cce0;}
#gameArea{display:flex;flex-direction:column;align-items:center;width:100%;max-width:720px;position:relative;}
canvas{background:radial-gradient(circle at center,#041220,#0a1b2e);border-radius:12px;max-width:100%;touch-action:none;}
.info-box{margin-top:12px;background:var(--panel);color:var(--text);padding:12px;border-radius:10px;min-height:50px;text-align:center;font-size:14px;}
button{margin-top:8px;padding:8px 14px;border:none;border-radius:8px;background:#00d9ff;color:#001020;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{background:#33e1ff;}
#overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:24px;border-radius:12px;z-index:10;}
#overlay button{font-size:18px;padding:10px 16px;}
#touchControls{
    display:none;
    position:absolute;
    bottom:10px;
    width:100%;
    max-width:720px;
    display:flex;
    justify-content:space-between;
    padding:0 20px;
    pointer-events:none;
    z-index:5;
}
.touch-btn{
    width:60px; height:60px;
    background:rgba(0,200,255,0.4);
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:28px;
    color:#001020;
    pointer-events:auto;
    box-shadow:0 0 8px rgba(0,255,255,0.5);
    user-select:none;
    transition:0.2s;
}
.touch-btn:active{background:rgba(0,200,255,0.7);}
@media (max-width:900px){#touchControls{display:flex;}}
</style>
</head>
<body>
<header>
<h1>Hepatitis B Defender</h1>
<div class="controls">← → mover | Tocar o barra espaciadora para disparar</div>
<div class="controls">Puntaje: <span id="scoreDisp">0</span> · Nivel: <span id="levelDisp">1</span> · Vidas: <span id="lifeDisp">3</span></div>
</header>

<div id="gameArea">
<canvas id="cnv" width="720" height="480"></canvas>
<div class="info-box" id="factBox">Neutralizá virus para ver datos.</div>
<div id="overlay">
    <div id="overlayText">HEPATITIS B DEFENDER</div>
    <button id="startBtn">JUGAR</button>
</div>
<div id="touchControls">
    <div id="leftBtn" class="touch-btn">◀</div>
    <div id="rightBtn" class="touch-btn">▶</div>
</div>
</div>

<script>
(() => {
const canvas=document.getElementById('cnv');
const ctx=canvas.getContext('2d');
const W=canvas.width,H=canvas.height;

let player={x:W/2,y:H-30,w:50,h:16,speed:6};
let keys={}, shots=[], viruses=[];
let score=0,level=1,lives=3,over=false,timer=0,interval=80,running=false, loopStarted=false;

const facts=[
    'La hepatitis B afecta al hígado.',
    'Se transmite por sangre y contacto sexual.',
    'La vacuna protege completamente contra la infección.',
    'Puede volverse crónica si no se trata.',
    'La hepatitis B crónica puede causar cirrosis.',
    'La hepatitis B puede permanecer días fuera del cuerpo.',
    'Se puede transmitir de madre a hijo al nacer.',
    'Existen varios genotipos del virus.',
    'La infección puede ser silenciosa.',
    'La vacuna se aplica en varias dosis.',
    'Se puede prevenir con prácticas seguras.',
    'La infección crónica requiere seguimiento médico.',
    'No se transmite por saliva ni abrazos.',
    'Es posible ser portador sin enfermarse.',
    'Los adultos sanos suelen recuperarse sin problemas.'
];

const scoreDisp=document.getElementById('scoreDisp');
const levelDisp=document.getElementById('levelDisp');
const lifeDisp=document.getElementById('lifeDisp');
const factBox=document.getElementById('factBox');
const overlay=document.getElementById('overlay');
const overlayText=document.getElementById('overlayText');
const startBtn=document.getElementById('startBtn');
const leftBtn=document.getElementById('leftBtn');
const rightBtn=document.getElementById('rightBtn');

function rand(a,b){return Math.random()*(b-a)+a;}
function spawnVirus(){
    let r = rand(15,22);
    viruses.push({
    x: rand(r,W-r),
    y: -r,
    r,
    vy: rand(0.7+level*0.2,1.3+level*0.3),
    hp: 1+Math.floor(level/3),
    angle: 0,
    angularSpeed: rand(-0.05,0.05)
    });
}
function shoot(){if(running && !over) shots.push({x:player.x,y:player.y-18,vy:-8});}

function update(){
    if(over || !running) return;
    if(keys['ArrowLeft']||keys['a']) player.x-=player.speed;
    if(keys['ArrowRight']||keys['d']) player.x+=player.speed;
    player.x=Math.max(player.w/2,Math.min(W-player.w/2,player.x));

    shots.forEach(s=>s.y+=s.vy);
    shots=shots.filter(s=>s.y>-20);

    timer++;
    if(timer>=interval){timer=0; spawnVirus();}

    viruses.forEach(v=>v.y+=v.vy);

    for(let i=viruses.length-1;i>=0;i--){
    const v=viruses[i];
    for(let j=shots.length-1;j>=0;j--){
    const s=shots[j];
    if(Math.hypot(s.x-v.x,s.y-v.y)<v.r+4){
        v.hp--; shots.splice(j,1);
        if(v.hp<=0){
        viruses.splice(i,1);
        score+=10*level; scoreDisp.textContent=score;
        factBox.textContent=facts[Math.floor(Math.random()*facts.length)];
        let newLevel=1+Math.floor(score/100);
        if(newLevel>level){level=newLevel; levelDisp.textContent=level; interval=Math.max(30,80-level*5);}
        }
        break;
    }
    }
    }

    for(let i=viruses.length-1;i>=0;i--){
    if(viruses[i].y-viruses[i].r>H){
    viruses.splice(i,1); lives--; lifeDisp.textContent=lives;
    if(lives<=0){gameOver(); return;}
    }
    }
}

function drawVirus(v){
    v.angle += v.angularSpeed;
    ctx.save();
    ctx.translate(v.x,v.y);
    ctx.rotate(v.angle);

    const g=ctx.createRadialGradient(-3,-3,2,0,0,v.r);
    g.addColorStop(0,'#ffb3b3'); g.addColorStop(1,'#ff3333');
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(0,0,v.r,0,Math.PI*2); ctx.fill();

    ctx.strokeStyle='#ff7b7b'; ctx.lineWidth=2;
    for(let i=0;i<8;i++){
    const ang=i/8*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(Math.cos(ang)*(v.r-2),Math.sin(ang)*(v.r-2));
    ctx.lineTo(Math.cos(ang)*(v.r+8),Math.sin(ang)*(v.r+8));
    ctx.stroke();
    }
    ctx.restore();
}

function draw(){
    ctx.clearRect(0,0,W,H);
  // jugador: mano
    ctx.fillStyle='#ffe0bd'; ctx.beginPath(); ctx.roundRect(player.x-15,player.y-10,30,20,5); ctx.fill();
    ctx.fillRect(player.x-12,player.y-18,5,8);
    ctx.fillRect(player.x-2,player.y-20,5,10);
    ctx.fillRect(player.x+8,player.y-18,5,8);

    shots.forEach(s=>{
    ctx.fillStyle='#6efcff'; ctx.fillRect(s.x-3,s.y-15,6,15);
    ctx.fillStyle='#aaa';
    ctx.beginPath(); ctx.moveTo(s.x-1,s.y-15); ctx.lineTo(s.x+1,s.y-15); ctx.lineTo(s.x,s.y-23); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='#33e1ff'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(s.x-2,s.y-5); ctx.lineTo(s.x+2,s.y-5); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(s.x-1,s.y-3); ctx.lineTo(s.x+1,s.y-3); ctx.stroke();
    });

    viruses.forEach(drawVirus);

    ctx.fillStyle='#fff'; ctx.font='14px Arial';
    ctx.fillText('Vidas: '+lives,12,20);
    ctx.fillText('Puntaje: '+score,12,38);
    ctx.fillText('Nivel: '+level,12,56);
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
function gameOver(){over=true; overlayText.textContent='GAME OVER'; startBtn.textContent='Reiniciar'; overlay.style.display='flex';}

canvas.addEventListener('touchstart', e=>{if(!running) return; shoot();});
canvas.addEventListener('touchmove', e=>{if(!running) return; if(e.touches.length===1){player.x=e.touches[0].clientX; player.x=Math.max(player.w/2,Math.min(W-player.w/2,player.x));}});

leftBtn.addEventListener('touchstart',e=>keys['ArrowLeft']=true);
leftBtn.addEventListener('touchend',e=>keys['ArrowLeft']=false);
rightBtn.addEventListener('touchstart',e=>keys['ArrowRight']=true);
rightBtn.addEventListener('touchend',e=>keys['ArrowRight']=false);

window.addEventListener('keydown',e=>{if(e.code==='Space'){e.preventDefault(); shoot();} keys[e.key]=true;});
window.addEventListener('keyup',e=>{keys[e.key]=false;});

function restart(){
    shots=[]; viruses=[]; timer=0; score=0; level=1; lives=3; over=false; interval=80;
    scoreDisp.textContent=score; levelDisp.textContent=level; lifeDisp.textContent=lives;
    factBox.textContent='Neutralizá virus para ver datos.'; overlay.style.display='none';
}

startBtn.addEventListener('click', ()=>{
    running=true; restart(); 
    if(!loopStarted){loop(); loopStarted=true;}
});

CanvasRenderingContext2D.prototype.roundRect = CanvasRenderingContext2D.prototype.roundRect || 
function(x,y,w,h,r){if(typeof r==='undefined') r=6; this.beginPath(); this.moveTo(x+r,y); this.arcTo(x+w,y,x+w,y+h,r); this.arcTo(x+w,y+h,x,y+h,r); this.arcTo(x,y+h,x,y,r); this.arcTo(x,y,x+w,y,r); this.closePath(); return this;};

})();
</script>
</body>
</html>

